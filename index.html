<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MineNepal Discord</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Discord-inspired theme */
    body {
      font-family: 'Poppins', sans-serif;
      background: #36393f;
      color: #dcddde;
    }

    .card {
      background: #2f3136;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.7);
    }

    .avatar {
      border-radius: 50%;
      border: 2px solid #7289da;
    }

    .btn-discord {
      background: #5865f2;
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      transition: background 0.2s;
    }

    .btn-discord:hover {
      background: #4752c4;
    }

    h1, h2, h3 {
      color: #ffffff;
    }

    li {
      background: #202225;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">

  <div class="w-full max-w-4xl">

    <!-- Title -->
    <h1 class="text-4xl font-bold mb-6 text-center">ðŸ’  MineNepal Discord Server ðŸ’ </h1>

    <!-- Join Button -->
    <button id="join-btn" class="w-full btn-discord mb-10 shadow-lg">
      Join Discord
    </button>

    <!-- Discord Widget Data -->
    <div id="widget" class="space-y-8">

      <div id="status" class="text-gray-400 text-center">Loading Discord data...</div>

      <!-- Server Info -->
      <div id="server-info" class="hidden card p-6">
        <h2 class="text-2xl font-bold mb-2" id="guild-name"></h2>
        <p class="text-gray-400 mb-2" id="guild-id"></p>
        <p class="text-gray-400" id="presence-count"></p>
      </div>

      <!-- Channels -->
      <div id="channels-section" class="hidden card p-6">
        <h3 class="text-xl font-semibold mb-4">ðŸ’¬ Channels</h3>
        <ul id="channels-list" class="space-y-2"></ul>
      </div>

      <!-- Members -->
      <div id="members-section" class="hidden card p-6">
        <h3 class="text-xl font-semibold mb-4">ðŸ‘¥ Online Members</h3>
        <div id="members-list" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4"></div>
      </div>

    </div>
  </div>

  <script>
    const WIDGET_URL = "https://discord.com/api/guilds/1438003174664568895/widget.json";

    // Join button redirect
    document.getElementById("join-btn").addEventListener("click", () => {
      const link1 = "https://discord.gg/afEaR72sEf"; // 60%
      const link2 = "https://discord.gg/2qGJrjzEpr"; // 40%
      window.location.href = Math.random() < 0.6 ? link1 : link2;
    });

    async function fetchWidget() {
      try {
        const res = await fetch(WIDGET_URL);
        if (!res.ok) throw new Error("Failed to fetch widget");
        const data = await res.json();

        document.getElementById("status").remove();

        // Server info
        document.getElementById("guild-name").textContent = data.name;
        document.getElementById("guild-id").textContent = "Server ID: " + data.id;
        document.getElementById("presence-count").textContent = `Online Members: ${data.presence_count}`;
        document.getElementById("server-info").classList.remove("hidden");

        // Channels
        if (data.channels && data.channels.length > 0) {
          const chList = document.getElementById("channels-list");
          data.channels.forEach(ch => {
            const li = document.createElement("li");
            li.textContent = ch.name + (ch.type === 2 ? " ðŸŽ¤" : "");
            chList.appendChild(li);
          });
          document.getElementById("channels-section").classList.remove("hidden");
        }

        // Members
        if (data.members && data.members.length > 0) {
          const memList = document.getElementById("members-list");
          data.members.forEach(m => {
            const div = document.createElement("div");
            div.className = "flex flex-col items-center";
            div.innerHTML = `
              <img src="${m.avatar_url}" alt="${m.username}" class="avatar w-16 h-16 mb-1">
              <span class="text-sm text-gray-300 text-center">${m.username}</span>
            `;
            memList.appendChild(div);
          });
          document.getElementById("members-section").classList.remove("hidden");
        }

      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = "Failed to load Discord data.";
      }
    }

    fetchWidget();
  </script>

</body>
</html>
